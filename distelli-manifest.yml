distelli/AddressBookAPI:
  Env:
    - PORT: "9000"
    - DB_ENDPOINT: "mysql://distelli-alpha.cedf018eguc7.us-east-1.rds.amazonaws.com:3306/addr_beta?maximumPoolSize=2"
    - DB_USER: "distelli"
    - DB_PASSWORD: "<specify-in-env>"
    - LOG4J_CONFIG: "file://$(pwd)/log4j.bundled.properties"
    - DB_CONFIG: "$(pwd)/db-config.json"
    - JAVA_HOME: /usr/bin
  StartSuccessTime: 30
  PostInstall:
    - bin/expand-db-config
    - mkdir -p logs
  Exec:
    - >
      exec "$JAVA_HOME/bin/java"
      -cp 'lib/*'
      -DPWD="$(pwd)"
      -Dlog4j.configuration="$LOG4J_CONFIG"
      run.Guice
      -Mcom.puppet.pipelines.api.addr.AddressBookAPIModule
      -Mcom.distelli.persistence.impl.PersistenceModule="$DB_CONFIG"
      com.distelli.webserver.GuiceWebServer.run="$PORT"
  Build:
    - mvn -q --settings settings.xml package dependency:copy-dependencies
  PkgInclude:
    - ["./target/*.jar", "lib/"]
    - ["./target/dependency/*.jar", "lib/"]
    - "/log4j.bundled.properties"
    - "./bin/"
    - "db-config.json.tmpl"
